--- svm_learn_main.c	2004-08-25 20:03:59.000000000 -0400
+++ svm_learn_main.c	2005-02-16 09:22:04.880654624 -0500
@@ -22,6 +22,8 @@
 /* extern "C" { */
 # include "svm_common.h"
 # include "svm_learn.h"
+#include "global.h"
+
 /* } */
 
 char docfile[200];           /* file with training examples */
@@ -44,7 +46,10 @@
   KERNEL_CACHE *kernel_cache;
   LEARN_PARM learn_parm;
   KERNEL_PARM kernel_parm;
-  MODEL *model=(MODEL *)my_malloc(sizeof(MODEL));
+  MODEL *model;
+
+  global_init();  /* THB - initialize global environment */
+  model =(MODEL *)my_malloc(sizeof(MODEL)); /* moved here from init section */
 
   read_input_parameters(argc,argv,docfile,modelfile,restartfile,&verbosity,
 			&learn_parm,&kernel_parm);
@@ -88,12 +93,15 @@
   /* deep_copy_of_model=copy_model(model); */
   write_model(modelfile,model);
 
-  free(alpha_in);
+  /** changed to use my_free **/
+  my_free(alpha_in);
   free_model(model,0);
   for(i=0;i<totdoc;i++) 
     free_example(docs[i],1);
-  free(docs);
-  free(target);
+  my_free(docs);
+  my_free(target);
+
+  global_destroy();
 
   return(0);
 }
